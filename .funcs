#!/usr/bin/env bash
# c00kiemon5ter (ivan.kanak@gmail.com) ~ under c00kiez License

# the prompt
prompt() {
	local s="$?" sc="$bfggrn" g= b=
	((s)) && sc="$fgylw" s="\[$bfgcyn\][\[$sc\]$s\[$bfgcyn\]]" || s=
    if b="$(git symbolic-ref HEAD 2>/dev/null)\[$fggrn\]"; then
        g="$(git status -s 2>/dev/null)"
		grep "^ \?[MADRCU]" <<< "$g" &>/dev/null && b+="!"
		grep "^??"          <<< "$g" &>/dev/null && b+="?"
		g="\[$fgwht\]:\[$fgylw\]${b#refs/heads/}"
	fi
	PS1="\n\[$fgcyn\]┐$s \[$bfgblu\]\h \[$fggrn\]\w$g\n\[$fgcyn\]└\[$sc\]─ \[$normal\]"
	PS2=" \[$fgcyn\]> \[$normal\]"
	PS3=" \[$bfgcyn\]> \[$normal\]"
	PS4="[$LINENO]+ "
}

# display a random quote on top of every new shell
wazaaa() {
	local qdb="$HOME/.archquotes" # quotes database
	local arch="Arch" nix="Linux" # the logo
	local say="$(shuf -n1 $qdb)"  # pick a random quote
	local spc="$(( COLUMNS - ${#arch} - ${#nix} ))"
	clear						  # ohai, kthnxbye
	printf "$mkbold$fgwht%s$bfgblu%s$fgwht%${spc}s$normal\n" "$arch" "$nix" "$say"
}

# cd helper
cd() {
    { [ -z "$1" ] && builtin cd "$HOME"; }           || \
    { [ -d "$1" ] && builtin cd "$1"; }              || \
    { [ -f "$1" ] && builtin cd "$(dirname "$1")"; } || \
    builtin cd "$1"
}
# copy and follow
cpf() { cp "$@" && cd "$_"; }
# move and follow
mvf() { mv "$@" && cd "$_"; }
# make dir and follow
mkf() { mkdir -vp "$1" && cd "$_"; }

# funny quotes from bash.org @irc
bashfortune() {
	curl -s http://bash.org/?random1 \
        | grep -oE "<p class=\"quote\">.*</p>.*</p>" \
        | grep -oE "<p class=\"qt.*?</p>" \
        | sed -e 's/<\/p>/\n/g' -e 's/<p class=\"qt\">//g' -e 's/<p class=\"qt\">//g' \
        | perl -ne 'use HTML::Entities;print decode_entities($_),"\n"' \
        | head -1
}

# slow output
slow_output() { while IFS= read -r -N1; do printf "%c" "$REPLY"; sleep ${1:-.02}; done; }

# change terminal title
tname() { printf "%b" "\e]0;${1:-$TERM}\a"; }

# alternative clear
cls() { printf "%b" "\ec"; }

# a tree alternative
t() { find "${1:-.}" -print | sed -e '2,$s;[^/]*/;|---- ;g;s;---- |;   |;g;s;|   |;  |;g;'; }

# vim: nospell
