#!/bin/bash
# c00kiemon5ter (ivan.kanak@gmail.com) ~ under c00kiez License

# the prompt
function prompt() {
	local st="$?" stclr="$fggrn" gpr=""
	local ref="$(git symbolic-ref HEAD 2>/dev/null)"
	(($st)) && stclr="$bfgred" st="\[$fgwht\][\[$stclr\]$st\[$fgwht\]]" || st=""
	if [ -n "$ref" ]
	then
		git status -s | grep "\\s*[MD]" &>/dev/null && ref="$ref\[$fggrn\]!"
		git status -s | grep "\\s*[?]"  &>/dev/null && ref="$ref\[$fggrn\]?"
		gpr="\[$fgwht\]:\[$fgylw\]${ref#refs/heads/}"
	fi
	PS1="\n$st\[$bfgblu\]\h \[$bfggrn\]\W$gpr \[$fgcyn\]>>\[$stclr\]> \[$normal\]"
	PS2=" \[$fgcyn\]> \[$normal\]"
	PS3=" \[$bfgcyn\]> \[$normal\]"
	PS4="[$LINENO]+ "
}

# display a random quote on top of every new shell
function wazaaa() {
	local qdb="$HOME/.archquotes" # quotes database
	local arch="Arch" nix="Linux" # the logo
	local say="$(shuf -n1 $qdb)"  # pick a random quote
	local spc="$(( COLUMNS - ${#arch} - ${#nix} ))"
	clear						  # ohai, kthnxbye
	printf "$mkbold$fgwht%s$bfgblu%s$fgwht%${spc}s$normal\n" "$arch" "$nix" "$say"
}

# cd helper
function cd() {
    { [ -z "$1" ] && builtin cd "$HOME"; }           || \
    { [ -d "$1" ] && builtin cd "$1"; }              || \
    { [ -f "$1" ] && builtin cd "$(dirname "$1")"; } || \
    builtin cd "$1"
}
# copy and follow
function cpf() {
	cp "$@" && goto "$_";
}
# move and follow
function mvf() {
	mv "$@" && goto "$_";
}
# make dir and follow
function mkf() {
    mkdir -vp "$1" && cd "$_";
}

# funny quotes from bash.org @irc
function bashfortune() {
	curl -s http://bash.org/?random1 \
        | grep -oE "<p class=\"quote\">.*</p>.*</p>" \
        | grep -oE "<p class=\"qt.*?</p>" \
        | sed -e 's/<\/p>/\n/g' -e 's/<p class=\"qt\">//g' -e 's/<p class=\"qt\">//g' \
        | perl -ne 'use HTML::Entities;print decode_entities($_),"\n"' \
        | head -1
}

# slow output
slow_output() {
    while IFS= read -r -N1; do printf "%c" "$REPLY"; sleep ${1:-.02}; done;
}

# change terminal title
function tname() {
	echo -ne "\033]0;${1:-$TERM}\007";
}

# vim: nospell
